<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot</title>
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
      function ChatInput({chatMessages, setChatMessages}) {
        const [inputText, setInputText] = React.useState('');

        function saveInputText(event) {
          setInputText(event.target.value);
        }

        function sendMessage() {
          const newChatMessages = [
            ...chatMessages, //... spread operate, takes values from array and copies them in a new array
            
            //after creating a copy then we want to add a new chat msg at the end of the copy
            //b/c we want to send a new msg, as shown below
            {
              message: inputText,
              sender: 'user',
              id: crypto.randomUUID()
            }
          ]
          setChatMessages(newChatMessages);

          /*
          states does not update immediately only after the code is finished this could lead to 
          the first msg not geing displayed but only the robot, so one way to fix this is to 
          save the msg into a varible which we did by using "const newChatMessages" and passed to
          setChatMessages() as shown above.
          
          and below instead of making  a copy of chatMessages we make a copy of newChatMessages
          this way it has our msg and the robot's message
          */


          const response = Chatbot.getResponse(inputText);
          setChatMessages([
            ...newChatMessages, //... spread operate, takes values from array and copies them in a new array
            
            //after creating a copy then we want to add a new chat msg at the end of the copy
            //b/c we want to send a new msg, as shown below
            {
              message: response,
              sender: 'robot',
              id: crypto.randomUUID()
            }
          ]);

          setInputText(''); //this sets the input box empty after user types
        }

        return (
          <> 
            <input 
              placeholder="Send a message to Chatbot" 
              size="30"
              onChange={saveInputText} // is an event funcion 
              value={inputText} //we can control the input box, by setting to empty after user sends msg
            />
            <button
              onClick={sendMessage}
            >Send</button>
          </>
        );
      }

      function ChatMessage({message, sender}){
       // const message = props.message;
       // const sender = props.sender;

       // const {message, sender} = props;


        // if(sender==='robot')
        // {
        //   return(
        //     <div>
        //       <img src="robot.png" width="50" />
        //       {message}
              
        //   </div>
        //   );
        // }

        return(
          <div>
            {sender ==='robot' && (
              <img src="robot.png" width="50" />
            )}
            {message}
            {sender === 'user' && (
              <img src="user.png" width="50" />
            )}
          </div>
        );
      }
      

      function ChatMessages({chatMessages}) {
        return(
          <>
            {chatMessages.map((chatMessage) => {
              return (
                <ChatMessage 
                  message={chatMessage.message}
                  sender={chatMessage.sender}
                  key={chatMessage.id}
                />
              );
            })}
          </>
        )
      }

      function App() {  

                //React.useState will update the chat msg in the html
        //React.useState returns an array and it returns 2 values 
        //we are directly array destructuring as shown below as well
        const [chatMessages, setChatMessages] = React.useState([{
          //by having the const (set)chatMessages inside App is called lifting the state up
          //this allows for the const (set)chatMessages to be used by ChatInput
          message: 'hello chat',
          sender: 'user',
          id: 'id1'
        }, {
          message: 'this is bot msg',
          sender: 'robot',
          id: 'id2'
        }]);
      
        //const [chatMessages, setChatMessages] = array; //array destructuring does the same as the code below

        /*
        const chatMessages = array[0]; //gets the current value that we get from array of React.useState
        const setChatMessages = array[1]; // we use "set" as naming convetion to update the data AKA updater function
                                          //React.useState 2nd value it return is a function that updates the data
*/


        return(
        <>
          <ChatInput //this allows ChatInput to use (set)chatMessages this would all need to be passed to the function
            chatMessages={chatMessages}
            setChatMessages = {setChatMessages}
          />
          <ChatMessages 
            chatMessages={chatMessages}
          />
        </>
        );
      }

      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>